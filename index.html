<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Homepage</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- HEADER / TOP BANNER -->
<div id="header">
  <div class="top-row">
    <div class="left">
      <img src="images/avatar.png" alt="Avatar">
      <span>title</span>
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="diary.html">Diary</a></li>
        <li><a href="football.html">Watford FC</a></li>
      </ul>
    </nav>
  </div>

  <div class="music-row">
    <iframe
      src="https://open.spotify.com/embed/track/1uLOYD6T0wdpOD8FcgsPuv"
      width="100%"
      height="88"
      frameborder="0"
      scrolling="no"
      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
    </iframe>
  </div>
</div>

<!-- MAIN CONTENT -->
<div id="content">

  <!-- Profile Box -->
  <div class="box profile-box">
    <div class="profile-inner">
      <div class="profile-image">
        <img src="images/profile.jpg" alt="Profile Image">
      </div>
      <div class="profile-text">
        <h1>Jai_Green</h1>
        <h2 class="subtitle">He/Him</h2>
        <h2 class="subtitle">19 Years Old</h2>
        <h2 class="subtitle">London</h2>
        <h2 class="subtitle">England</h2>
        <p>Currently studying at Central Saint Martins.</p>
      </div>
    </div>
  </div>

  <!-- Films Box -->
  <div class="box">
    <h2 class="subtitle">Recently Watched</h2>
    <div id="films-container"></div>
  </div>

  <!-- Latest Diary Entry -->
  <div id="latest-entry"></div>

</div> <!-- /#content -->

<!-- Load diary data first -->
<script src="diaryData.js"></script>

<script>
// -------------------------
// LETTERBOXD - Recently Watched (6 only)
// -------------------------
const feedURL = 'https://letterboxd.com/jai_movies/rss/';
const container = document.getElementById('films-container');

fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedURL)}`)
  .then(res => res.json())
  .then(data => {
    if (data.items && data.items.length > 0) {
      data.items.slice(0,6).forEach(item => {
        const title = item.title;
        const link = item.link;
        const pubDate = new Date(item.pubDate).toLocaleDateString();
        let thumbnail = '';
        const imgMatch = item.content.match(/<img[^>]+src="([^">]+)"/);
        if (imgMatch) thumbnail = imgMatch[1];
        const div = document.createElement('div');
        div.className = 'film-item';
        div.innerHTML = `
          <a href="${link}" target="_blank">
            ${thumbnail ? `<img src="${thumbnail}" alt="${title}">` : ''}
          </a>
          <p><strong>${title}</strong></p>
          <p>${pubDate}</p>
        `;
        container.appendChild(div);
      });
    }
  })
  .catch(err => console.error('Error fetching RSS:', err));

// -------------------------
// LATEST DIARY ENTRY
// -------------------------
const latest = diaryData[0];
const latestDiv = document.getElementById('latest-entry');
latestDiv.className = 'box entry';

// Start HTML
let html = `<h2 class="subtitle">Latest Diary Entry</h2>
            <h3 class="subtitle">${latest.date}</h3>
            <p>${latest.text}</p>`;

// Add images
latest.images.forEach((img,i) => {
  html += `<img src="${img}" alt="Diary Image"><p class="caption">${latest.captions[i]||''}</p>`;
});

// Add videos
if (latest.videos.length) {
  html += `
<video id="player-0" controls>
  <source src="${latest.videos[0].src}" type="video/quicktime">
</video>
    <div class="video-controls">
      <button onclick="prevVideo(0)">← Prev</button>
      <span id="video-counter-0">1 / ${latest.videos.length}</span>
      <button onclick="nextVideo(0)">Next →</button>
    </div>
  `;
  latest.currentVideo = 0;
}

// Render everything
latestDiv.innerHTML = html;

// Video navigation
function prevVideo(i) {
  const entry = diaryData[i];
  entry.currentVideo =
    (entry.currentVideo - 1 + entry.videos.length) % entry.videos.length;

  const video = document.getElementById(`player-${i}`);
  const source = video.querySelector('source');

  source.src = entry.videos[entry.currentVideo].src;
  video.load();

  document.getElementById(`video-counter-${i}`).textContent =
    `${entry.currentVideo + 1} / ${entry.videos.length}`;
}

function nextVideo(i) {
  const entry = diaryData[i];
  entry.currentVideo =
    (entry.currentVideo + 1) % entry.videos.length;

  const video = document.getElementById(`player-${i}`);
  const source = video.querySelector('source');

  source.src = entry.videos[entry.currentVideo].src;
  video.load();

  document.getElementById(`video-counter-${i}`).textContent =
    `${entry.currentVideo + 1} / ${entry.videos.length}`;
}

// -------------------------
// VISITOR COUNTER
// -------------------------
let count = localStorage.getItem('hitCount')||0;
count = parseInt(count)+1;
localStorage.setItem('hitCount',count);
const counterWrapper = document.createElement('div');
counterWrapper.id='hit-counter-wrapper';
counterWrapper.innerHTML=`Visitors: <span id="counter-display">${count}</span>`;
document.body.appendChild(counterWrapper);

</script>

<footer>
  <p>© 2026 My Site</p>
</footer>

</body>
</html>
