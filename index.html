<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Homepage</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- HEADER / TOP BANNER -->
<div id="header">
  <div class="top-row">
    <div class="left">
      <img src="images/avatar.png" alt="Avatar">
      <span>title</span>
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="diary.html">Diary</a></li>
        <li><a href="football.html">Watford FC</a></li>
      </ul>
    </nav>
  </div>

  <div class="music-row">
    <iframe
      src="https://open.spotify.com/embed/track/1uLOYD6T0wdpOD8FcgsPuv"
      width="100%"
      height="88"
      frameborder="0"
      scrolling="no"
      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
    </iframe>
  </div>
</div>

<!-- MAIN CONTENT -->
<div id="content">

  <!-- Profile Box -->
  <div class="box profile-box">
    <div class="profile-inner">
      <div class="profile-image">
        <img src="images/profile.jpg" alt="Profile Image">
      </div>
      <div class="profile-text">
        <h1>Jai_Green</h1>
        <h2 class="subtitle">He/Him</h2>
        <h2 class="subtitle">19 Years Old</h2>
        <h2 class="subtitle">London</h2>
        <h2 class="subtitle">England</h2>
        <p>Currently studying at Central Saint Martins.</p>
      </div>
    </div>
  </div>

  <!-- Films Box -->
  <div class="box">
    <h2 class="subtitle">Recently Watched</h2>
    <div id="films-container"></div>
  </div>

  <!-- Latest Diary Entry -->
  <div id="latest-entry"></div>

</div> <!-- /#content -->

<!-- Load diary data -->
<script src="diaryData.js"></script>

<script>
  // -----------------------------
  // Latest Diary Entry
  // -----------------------------
  const latestDiv = document.getElementById("latest-entry");
  const entry = diaryData[0]; // first entry is latest
  entry.currentVideo = 0;
  entry.currentImage = 0;

  let html = `<div class="box entry" style="width:100%; min-height:300px;">
                <h2 class="subtitle">Latest Diary Entry</h2>
                <h3 class="subtitle">${entry.date}</h3>`;

  entry.text.split("\n\n").forEach(p => {
    html += `<p>${p}</p>`;
  });

  // Images
  if (entry.images.length) {
    html += `<img id="latest-image" src="${entry.images[0]}" 
                 style="max-width:600px; width:100%; height:auto; display:block; margin:12px auto;">`;
    if (entry.images.length > 1) {
      html += `<div style="margin-bottom:12px; text-align:center;">
                 <button onclick="prevLatestImage()">← Prev</button>
                 <span id="latest-image-counter">1 / ${entry.images.length}</span>
                 <button onclick="nextLatestImage()">Next →</button>
               </div>`;
    }
  }

  // Videos
  if (entry.videos.length) {
    html += `<video id="latest-video" controls preload="metadata" 
                   style="width:100%; max-width:800px; display:block; margin:12px auto;">
               <source src="${entry.videos[0].src}" type="video/mp4">
               Your browser does not support the video tag.
             </video>`;
    if (entry.videos.length > 1) {
      html += `<div class="video-controls" style="margin-bottom:12px; text-align:center;">
                 <button onclick="prevLatestVideo()">← Prev</button>
                 <span id="latest-video-counter">1 / ${entry.videos.length}</span>
                 <button onclick="nextLatestVideo()">Next →</button>
               </div>`;
    }
    html += `<p id="latest-video-caption" class="caption">${entry.captions[0] || ""}</p>`;
  }

  html += `</div>`;
  latestDiv.innerHTML = html;

  // -----------------------------
  // Image navigation
  // -----------------------------
  function prevLatestImage() {
    entry.currentImage = (entry.currentImage - 1 + entry.images.length) % entry.images.length;
    updateLatestImage();
  }
  function nextLatestImage() {
    entry.currentImage = (entry.currentImage + 1) % entry.images.length;
    updateLatestImage();
  }
  function updateLatestImage() {
    document.getElementById("latest-image").src = entry.images[entry.currentImage];
    const counter = document.getElementById("latest-image-counter");
    if (counter) counter.textContent = `${entry.currentImage + 1} / ${entry.images.length}`;
  }

  // -----------------------------
  // Video navigation
  // -----------------------------
  function prevLatestVideo() {
    entry.currentVideo = (entry.currentVideo - 1 + entry.videos.length) % entry.videos.length;
    updateLatestVideo();
  }
  function nextLatestVideo() {
    entry.currentVideo = (entry.currentVideo + 1) % entry.videos.length;
    updateLatestVideo();
  }
  function updateLatestVideo() {
    const videoEl = document.getElementById("latest-video");
    videoEl.src = entry.videos[entry.currentVideo].src;
    videoEl.load();
    const counter = document.getElementById("latest-video-counter");
    if (counter) counter.textContent = `${entry.currentVideo + 1} / ${entry.videos.length}`;
    const captionEl = document.getElementById("latest-video-caption");
    if (captionEl) captionEl.textContent = entry.captions[entry.currentVideo] || "";
  }

  // -------------------------
  // LETTERBOXD - Recently Watched (6 only)
  // -------------------------
  const feedURL = 'https://letterboxd.com/jai_movies/rss/';
  const filmsContainer = document.getElementById('films-container');

  fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedURL)}`)
    .then(res => res.json())
    .then(data => {
      if (data.items && data.items.length > 0) {
        data.items.slice(0,6).forEach(item => {
          const title = item.title;
          const link = item.link;
          const pubDate = new Date(item.pubDate).toLocaleDateString();
          let thumbnail = '';
          const imgMatch = item.content.match(/<img[^>]+src="([^">]+)"/);
          if (imgMatch) thumbnail = imgMatch[1];
          const div = document.createElement('div');
          div.className = 'film-item';
          div.innerHTML = `
            <a href="${link}" target="_blank">
              ${thumbnail ? `<img src="${thumbnail}" alt="${title}">` : ''}
            </a>
            <p><strong>${title}</strong></p>
            <p>${pubDate}</p>
          `;
          filmsContainer.appendChild(div);
        });
      }
    })
    .catch(err => console.error('Error fetching RSS:', err));

  // -------------------------
  // VISITOR COUNTER
  // -------------------------
  let count = localStorage.getItem('hitCount')||0;
  count = parseInt(count)+1;
  localStorage.setItem('hitCount',count);
  const counterWrapper = document.createElement('div');
  counterWrapper.id='hit-counter-wrapper';
  counterWrapper.innerHTML=`Visitors: <span id="counter-display">${count}</span>`;
  document.body.appendChild(counterWrapper);
</script>

<footer>
  <p>© 2026 My Site</p>
</footer>

</body>
</html>
