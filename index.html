<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Homepage</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<!-- HEADER / TOP BANNER -->
<div id="header">
  <div class="top-row">
    <div class="left">
      <img src="images/avatar.png" alt="Avatar">
      <span>title</span>
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="diary.html">Diary</a></li>
        <li><a href="football.html">Watford FC</a></li>
      </ul>
    </nav>
  </div>

  <div class="music-row">
    <iframe
      src="https://open.spotify.com/embed/track/1uLOYD6T0wdpOD8FcgsPuv"
      width="100%"
      height="88"
      frameborder="0"
      scrolling="no"
      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
    </iframe>
  </div>
</div>

<!-- MAIN CONTENT -->
<div id="content">

  <!-- Profile Box -->
  <div class="box profile-box">
    <div class="profile-inner">
      <div class="profile-image">
        <img src="images/profile.jpg" alt="Profile Image">
      </div>
      <div class="profile-text">
        <h1>Jai_Green</h1>
        <h2 class="subtitle">He/Him</h2>
        <h2 class="subtitle">19 Years Old</h2>
        <h2 class="subtitle">London</h2>
        <h2 class="subtitle">England</h2>
        <p>Currently studying at Central Saint Martins.</p>
      </div>
    </div>
  </div>

  <!-- Films Box -->
  <div class="box">
    <h2 class="subtitle">Recently Watched</h2>
    <div id="films-container"></div>
  </div>

  <!-- Latest Diary Entry -->
  <div id="latest-entry"></div>

</div> <!-- /#content -->

<!-- Load diary data first -->
<script src="diaryData.js"></script>

<script>
window.onload = function() {
  const latest = diaryData[0]; // first entry is latest
  latest.currentVideo = 0;
  latest.currentImage = 0;

  const latestDiv = document.getElementById('latest-entry');
  latestDiv.className = 'box entry';
  let html = `<h2 class="subtitle">Latest Diary Entry</h2>
              <h3 class="subtitle">${latest.date}</h3>`;

  // Split text
  latest.text.split("\n\n").forEach(p => html += `<p>${p}</p>`);

  // Images
  if(latest.images.length) {
    html += `<img id="latest-image" src="${latest.images[0]}" alt="Diary Image">`;
    if(latest.images.length > 1){
      html += `<div style="margin-bottom:12px;">
                 <button onclick="prevLatestImage()">← Prev</button>
                 <span id="latest-image-counter">1 / ${latest.images.length}</span>
                 <button onclick="nextLatestImage()">Next →</button>
               </div>`;
    }
  }

  // Videos
  if(latest.videos.length) {
    html += `<video id="latest-video" controls preload="metadata" style="width:100%; max-width:800px;">
               <source src="${latest.videos[0].src}" type="video/mp4">
               Your browser does not support the video tag.
             </video>`;
    if(latest.videos.length > 1){
      html += `<div class="video-controls" style="margin-bottom:5px;">
                 <button onclick="prevLatestVideo()">← Prev</button>
                 <span id="latest-video-counter">1 / ${latest.videos.length}</span>
                 <button onclick="nextLatestVideo()">Next →</button>
               </div>`;
    }
    html += `<p id="latest-video-caption" class="caption">${latest.captions?.[0] || ''}</p>`;
  }

  latestDiv.innerHTML = html;

  // -----------------------------
  // IMAGE NAVIGATION
  // -----------------------------
  function updateLatestImage(){
    const imgEl = document.getElementById('latest-image');
    imgEl.src = latest.images[latest.currentImage];
    const counter = document.getElementById('latest-image-counter');
    if(counter) counter.textContent = `${latest.currentImage+1} / ${latest.images.length}`;
  }
  window.prevLatestImage = function(){ latest.currentImage = (latest.currentImage-1+latest.images.length)%latest.images.length; updateLatestImage(); }
  window.nextLatestImage = function(){ latest.currentImage = (latest.currentImage+1)%latest.images.length; updateLatestImage(); }

  // -----------------------------
  // VIDEO NAVIGATION
  // -----------------------------
  function updateLatestVideo(){
    const videoEl = document.getElementById('latest-video');
    videoEl.src = latest.videos[latest.currentVideo].src;
    videoEl.load();
    const counter = document.getElementById('latest-video-counter');
    if(counter) counter.textContent = `${latest.currentVideo+1} / ${latest.videos.length}`;
    const captionEl = document.getElementById('latest-video-caption');
    if(captionEl) captionEl.textContent = latest.captions?.[latest.currentVideo] || '';
  }
  window.prevLatestVideo = function(){ latest.currentVideo = (latest.currentVideo-1+latest.videos.length)%latest.videos.length; updateLatestVideo(); }
  window.nextLatestVideo = function(){ latest.currentVideo = (latest.currentVideo+1)%latest.videos.length; updateLatestVideo(); }

  // -----------------------------
  // LETTERBOXD - Recently Watched (6 only)
  // -----------------------------
  const feedURL = 'https://letterboxd.com/jai_movies/rss/';
  const container = document.getElementById('films-container');
  fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedURL)}`)
    .then(res => res.json())
    .then(data => {
      if(data.items?.length){
        data.items.slice(0,6).forEach(item=>{
          const title = item.title;
          const link = item.link;
          const pubDate = new Date(item.pubDate).toLocaleDateString();
          let thumbnail = '';
          const imgMatch = item.content.match(/<img[^>]+src="([^">]+)"/);
          if(imgMatch) thumbnail = imgMatch[1];
          const div = document.createElement('div');
          div.className = 'film-item';
          div.innerHTML = `<a href="${link}" target="_blank">${thumbnail?`<img src="${thumbnail}" alt="${title}">`:''}</a>
                           <p><strong>${title}</strong></p>
                           <p>${pubDate}</p>`;
          container.appendChild(div);
        });
      }
    }).catch(err=>console.error('Error fetching RSS:',err));

  // -----------------------------
  // VISITOR COUNTER
  // -----------------------------
  let count = parseInt(localStorage.getItem('hitCount')||0)+1;
  localStorage.setItem('hitCount',count);
  const counterWrapper = document.createElement('div');
  counterWrapper.id='hit-counter-wrapper';
  counterWrapper.innerHTML=`Visitors: <span id="counter-display">${count}</span>`;
  document.body.appendChild(counterWrapper);
};
</script>

<footer>
  <p>© 2026 My Site</p>
</footer>

</body>
</html>
